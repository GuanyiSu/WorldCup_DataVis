<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="d3.js"></script>
    <title>graph1</title>
    <style type="text/css">     
        #slider {
            position: absolute; 
            top: 170px; 
            left: 40px; 
            height: 450px;
            width: 20px;
            -webkit-appearance: slider-vertical;
        }

        #input2 {
            position: absolute;
            left: 1000px;
            top: 0px
        }

        .graph3_div {
            height: 15px;
            width: 15px;
            display: inline-block;
        }
        
        #graph3_div_big {
            position: absolute;
            top: 800px
        }

        #svg3 {
            position: absolute;
            top: 1000px;
            left: 150px;
        }

        #graph4_div {
            position: absolute;
            top: 800px;
            left: 1000px;
        }

        #svg4 {
            position: absolute;
            top: 1100px;
            left: 1000px;
        }
    </style>
</head>
<body>
    
    <div>
        <h1>Ball Possession Rate VS Number Of Goals</h1>
        <input id="slider" type="range" min="100" max="1200" step="1" value="0" orient="horizontal">
    </div>
    

     <div id="input2">
        <h1 style="text-align: center;">Match Hour VS Avg total Goal attempts in the Match</h1>
        
            <input type="radio" name="filterPreset" value="1"> total attempts
            <input type="radio" name="filterPreset" value="2"> on-target attempts
    </div>

    <div id="graph3_div_big">
        <h1>WorldCup Final Players' Relations</h1>
        <ul>
            <li><div class="graph3_div" style="background-color: blue;"></div> Premier League </li>
            <li><div class="graph3_div" style="background-color: pink;"></div> La Liga</li>
            <li><div class="graph3_div" style="background-color: green;"></div> Serie A</li>
            <li><div class="graph3_div" style="background-color: orange;"></div> Ligue 1</li>
        </ul>
    </div>

    <div id="graph4_div">
        <h1 style="text-align: center;">Match Stats for the Final Four Teams of WorldCup 2022</h1>
        <ul>
            <li><div class="graph3_div" style="background-color: blue;"></div> Argentina </li>
            <li><div class="graph3_div" style="background-color: orange;"></div> Morocco</li>
            <li><div class="graph3_div" style="background-color: green;"></div>France</li>
            <li><div class="graph3_div" style="background-color: Red;"></div>Croatia</li>
        </ul>
        <p>
            <input class="select4" type="radio" name="filterPreset" value="1"> total attempts
            <input class="select4" type="radio" name="filterPreset" value="2"> defensive pressures applied
            <input class="select4" type="radio" name="filterPreset" value="3"> switches of play completed
        </p>
    </div>
    
    <script>
        let w1 = 600;
        let h1 = 520;
        
        var margin = {
            left: 200,
            right: 50,
            top: 50,
            bottom: 50
        };
    
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w1)
                    .attr("height", h1)
        
        d3.csv("worldCup.csv").then((data) =>  {
            var max_possession = 0;
            var max_goal = 0;
    
            var min_pass = 1000;
            var max_pass = 0;
            
            var possesion_goal = []
            
            data.forEach(d => {
                var possession1 = d['possession team1'];
                var possession2 = d['possession team2'];
                var goals1 = d['number of goals team1'];
                var goals2 = d['number of goals team2'];
                var passes1 = d['passes team1'];
                var passes2 = d['passes team2'];
    
                max_possession = Math.max(max_possession, +possession1.substring(0, possession1.length - 1));
                max_possession = Math.max(max_possession, +possession2.substring(0, possession2.length - 1));
                
                max_goal = Math.max(max_goal, +goals1);
                max_goal = Math.max(max_goal, +goals2);
    
                min_pass = Math.min(min_pass, Math.min(passes1, passes2));
                max_pass = Math.max(max_pass, Math.max(passes1, passes2));
    
                possesion_goal.push({
                    possession: +possession1.substring(0, possession1.length - 1),
                    goal: +goals1,
                    passes: +passes1
                })
    
                possesion_goal.push({
                    possession: +possession2.substring(0, possession2.length - 1),
                    goal: +goals2,
                    passes: +passes2
                })
            })
    
            var xScale = d3.scaleLinear()
                                .domain([0, max_possession])
                                .range([margin.left, w1 - margin.right]);
    
            var yScale = d3.scaleLinear()
                            .domain([0, max_goal])
                            .range([h1 - margin.top, margin.top]);
    
            var xAxis = d3.axisBottom()
                            .scale(xScale);
    
            var yAxis = d3.axisLeft()
                            .scale(yScale);
    
            svg.selectAll("circle")
                .data(possesion_goal)
                .enter()
                .append("circle")
                .attr("cx", (d)=> {
                    return xScale(d.possession);
                })
                .attr("cy", (d)=> {
                    return yScale(d.goal);
                })
                .attr("r", (d)=> {
                    return 4;
                })
                .attr("fill","black")
    
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + margin.left + ",0)")
                .call(yAxis);
            
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h1 - margin.top) + ")")
                .call(xAxis);
    
            svg.append("text")
                .attr("y", h1 - 20)
                .attr("x", w1/2 - 20)
                .text("ball possession (%)");
            
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 150)
                .attr("x", -300)
                .text("number of goals");
    
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 70)
                .attr("x", -400)
                .text("number of passes");
    
            d3.select("#slider")
            .on("change", function() {
                let threshold = +d3.select(this).node().value;
    
                svg.selectAll("circle")
                    .attr("fill", (d)=> {
                        if (d['passes'] <= (threshold))
                            return "red";
                        else
                            return "black";
                    })
            });
        })

        // graph2 -----------------

        let w2 = 800;
        let h2 = 600;

        var hashmap = new Map();
        var final_data = [];
    
        var margin = {
            left: 200,
            right: 50,
            top: 50,
            bottom: 50
        };
    
        var svg1 = d3.select("body")
                .append("svg")
                .attr("width", w2)
                .attr("height", h2);
    
        d3.csv("worldCup.csv").then((data) =>  {
            data.forEach((d) => {
                var hour = d['hour'];
                var total_shots1 = +d['total attempts team1'];
                var total_shots2 = +d['total attempts team2'];
                var target_shots1 = +d['on target attempts team1'];
                var target_shots2 = +d['on target attempts team2'];
                if(hashmap.has(hour)) {
                    var obj = hashmap.get(hour);
                    obj.total.push(total_shots1 + total_shots2);
                    //obj.total.push(total_shots2);
                    obj.target.push(target_shots1 + total_shots2);
                    //obj.target.push(target_shots2);
                }
                else {
                    hashmap.set(hour, {
                        total: [],
                        target: []
                    })
                }
            });
            for (let [k, v] of hashmap.entries()) {
                let total_arr = v.total;
                let target_arr = v.target;
                final_data.push([k, total_arr.reduce((a, b) => a + b, 0) / total_arr.length, target_arr.reduce((a, b) => a + b, 0) / target_arr.length]);
            }
    
            console.log(final_data);
            var hours = [];
            var totals = [];
            var targets = [];
    
        final_data.forEach((d) => {
            hours.push(d[0]);
            totals.push(d[1]);
            targets.push(d[2]);
        })
    
        var xScale = d3.scaleLinear()
                        .domain([0, 30])
                        .range([margin.left, w2 - margin.right]);
    
        var yScale = d3.scaleLinear()
                        .domain([0, 30])
                        .range([h2 - margin.top, margin.top]);
    
        var xAxis = d3.axisBottom()
                        .scale(xScale);
    
        var yAxis = d3.axisLeft()
                        .scale(yScale);
    
        svg1.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(" + margin.left + ",0)")
            .call(yAxis);
    
        svg1.selectAll("rect")
            .data(final_data)
            .enter()
            .append("rect")
            .attr("x", (d, i)=> {
                return margin.left + 50 + i * 100;
            })
            .attr("y", (d)=> {
                return yScale(d[1]);
            })
            .attr("width", 50)
            .attr("height", (d)=> {
                return h2 - margin.bottom - yScale(d[1]);
            })
            .attr("fill", "orange");
    
        svg1.selectAll("text.label")
            .data(final_data)
            .enter()
            .append('text')
            .attr('x', (d, i) => {
                return margin.left + 55 + i * 100;
            })
            .attr('y', (d) => {
                return yScale(d[1]) + 50
            })
            .text((d) => {
                return Number(d[1]).toFixed(2);
            })
            .attr('fill', 'white')
    
        svg1.selectAll("text.bottom")
            .data(final_data)
            .enter()
            .append('text')
            .attr('x', (d, i) => {
                return margin.left + 55 + i * 100;
            })
            .attr('y', (d) => {
                return h2 - 30
            })
            .text((d) => {
                return d[0];
            })
        })
    
        d3.selectAll("input")
        .on("change", function() {
            var yScale = d3.scaleLinear()
                        .domain([0, 30])
                        .range([h2 - margin.top, margin.top]);
            
            svg1.selectAll("rect").remove()
            svg1.selectAll("text.label").remove()
    
            let selected = +d3.select(this).node().value;
            if (selected == 1) {
                svg1.selectAll("text.label").remove()
                svg1.selectAll("rect")
                    .data(final_data)
                    .enter()
                    .append("rect")
                    .attr("x", (d, i)=> {
                        return margin.left + 50 + i * 100;
                    })
                    .attr("y", (d)=> {
                        return yScale(d[1]);
                    })
                    .attr("width", 50)
                    .attr("height", (d)=> {
                        return h2 - margin.bottom - yScale(d[1]);
                    })
                    .attr("fill", "orange");
    
                svg1.selectAll("text.label")
                    .data(final_data)
                    .enter()
                    .append('text')
                    .attr('x', (d, i) => {
                        return margin.left + 55 + i * 100;
                    })
                    .attr('y', (d) => {
                        return yScale(d[1]) + 50
                    })
                    .text((d) => {
                        return Number(d[1]).toFixed(2);
                    })
                    .attr('fill', 'white')
            }
            else {
                svg1.selectAll("text.label").remove()
                svg1.selectAll("rect")
                .data(final_data)
                .enter()
                .append("rect")
                .attr("x", (d, i)=> {
                    return margin.left + 50 + i * 100;
                })
                .attr("y", (d)=> {
                    return yScale(d[2]);
                })
                .attr("width", 50)
                .attr("height", (d)=> {
                    return h2 - margin.bottom - yScale(d[2]);
                })
                .attr("fill", "red");
    
                svg1.selectAll("text.label")
                    .data(final_data)
                    .enter()
                    .append('text')
                    .attr('x', (d, i) => {
                        return margin.left + 55 + i * 100;
                    })
                    .attr('y', (d) => {
                        return yScale(d[2]) + 50
                    })
                    .text((d) => {
                        return Number(d[2]).toFixed(2);
                    })
                    .attr('fill', 'white')
            }
        });

        // Graph3 -----------------
        var w3 = 700;
        var h3 = 700;
    
        d3.json("final_match.json").then(function(data){ 
            let svg3 = d3.select("body")
                        .append("svg")
                        .attr("width", w3)
                        .attr("height", h3)
                        .attr("id", "svg3");
            
            data.edges.forEach((d) => {
                d.source -= 1;
                d.target -= 1;
            });
            
            let simulation = d3.forceSimulation(data.nodes)
                        .force("charge", d3.forceManyBody(-30))
                        .force("link", d3.forceLink(data.edges).distance(500))
                        .force("center", d3.forceCenter().x(w3/2).y(h3/2));
                
            let nodes = svg3.selectAll("circle")
                .data(data.nodes)
                .enter()
                .append("circle")
                .attr("r", 7)
                .style("fill", (d)=> {
                    switch(d.Alliance) {
                        case "Argentina":
                            return "DeepSkyBlue" 
                        case "France":
                            return "Purple"
                    }
                })
                .on("mouseover", (event,d) => {
                    svg3.append("text")
                        .attr("x", d.x)
                        .attr("y", d.y - 10)
                        .attr("font-size", "20px")
                        .attr("fill", "black")
                        .attr("text-anchor", "middle")
                        .attr("id", "name")
                        .text((d["Label"]));
                })
                .on("mouseout", () => {
                        d3.select("#name").remove();
                });

                let edges = svg3.selectAll("line")
                .data(data.edges)
                .enter()
                .append("line")
                .style("stroke-width", 1.5)
                .style("stroke",(d, i)=> {
                    switch(d.Relationship) {
                        case "premier league":
                            return "Blue" 
                        case "La Liga":
                            return "pink"
                        case "Serie A":
                            return "green"
                        case "Ligue 1":
                            return "orange"
                    }
                })
            
            simulation.on("tick", () => {
                nodes.attr("cx", (d)=> { return d.x; })
                    .attr("cy", (d)=> { return d.y; });
                edges.attr("x1", (d)=> { return d.source.x; })
                    .attr("y1", (d)=> { return d.source.y; })
                    .attr("x2", (d)=> { return d.target.x; })
                    .attr("y2", (d)=> { return d.target.y; });
            }); 
        }); 


        // Graph4 ----------------
        var map4 = new Map();

            //Width and height
			let w4 = 500;
			let h4 = 500;

            map4.set('ARGENTINA', {
                lineBreaks: 0,
                defensivePressure: 0,
                switchesOfPlay: 0
            });
            map4.set('MOROCCO', {
                lineBreaks: 0,
                defensivePressure: 0,
                switchesOfPlay: 0
            });
            map4.set('FRANCE', {
                lineBreaks: 0,
                defensivePressure: 0,
                switchesOfPlay: 0
            });
            map4.set('CROATIA', {
                lineBreaks: 0,
                defensivePressure: 0,
                switchesOfPlay: 0
            });

            d3.csv("worldCup.csv").then((data) =>  {
                data.forEach(d => {
                    let team1 = d['team1'];
                    let team2 = d['team2'];
                    if (map4.has(d['team1'])) {
                        map4.get(team1).lineBreaks += +d['total attempts team1'];
                        map4.get(team1).defensivePressure += +d['defensive pressures applied team1'];
                        map4.get(team1).switchesOfPlay += +d['switches of play completed team1'];
                    }
                    if (map4.has(d['team2'])) {
                        map4.get(team2).lineBreaks += +d['total attempts team2'];
                        map4.get(team2).defensivePressure += +d['defensive pressures applied team2'];
                        map4.get(team2).switchesOfPlay += +d['switches of play completed team2'];
                    }
                });

                var attempts = [];
                var defense = [];
                var switches = [];

                for (let [key, value] of map4.entries()) {
                    attempts.push(value.lineBreaks);
                    defense.push(value.defensivePressure);
                    switches.push(value.switchesOfPlay);
                }

                let outerRadius = w4 / 2;
                let innerRadius = 0;
                let arc = d3.arc()
                            .innerRadius(innerRadius)
                            .outerRadius(outerRadius);

                let pie = d3.pie();

                //Easy colors accessible via a 10-step ordinal scale
                let color = d3.scaleOrdinal(d3.schemeCategory10);

                //Create SVG element
                let svg4 = d3.select("body")
                            .append("svg")
                            .attr("width", w4)
                            .attr("height", h4)
                            .attr("id", "svg4");

                //Set up groups
                let arcs = svg4.selectAll("g.arc")
                            .data(pie(attempts))
                            .enter()
                            .append("g")
                            .attr("class", "arc")
                            .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

                //Draw arc paths
                arcs.append("path")
                    .attr("fill", (d, i)=> {
                        return color(i);
                    })
                    .attr("d", arc);

                //Labels
                arcs.append("text")
                    .attr("transform", (d)=> {
                        return "translate(" + arc.centroid(d) + ")";
                    })
                    .attr("text-anchor", "middle")
                    .attr("fill", "white")
                    .text((d)=> {
                        return d.value;
                    }); 

                d3.selectAll(".select4").on("change", function() {

                    let select4 = +d3.select(this).node().value;
                    svg4.selectAll("g.arc").remove()

                    if(select4 == 1) {
                        arcs = svg4.selectAll("g.arc")
                            .data(pie(attempts))
                            .enter()
                            .append("g")
                            .attr("class", "arc")
                            .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")")

                            //Draw arc paths
                            arcs.append("path")
                                .attr("fill", (d, i)=> {
                                    return color(i);
                                })
                                .attr("d", arc)
                                .transition()
                                .duration(2000);

                            //Labels
                            arcs.append("text")
                                .attr("transform", (d)=> {
                                    return "translate(" + arc.centroid(d) + ")";
                                })
                                .attr("text-anchor", "middle")
                                .attr("fill", "white")
                                .text((d)=> {
                                    return d.value;
                                }); 
                    }
                    else if (select4 == 2) {
                        arcs = svg4.selectAll("g.arc")
                            .data(pie(defense))
                            .enter()
                            .append("g")
                            .attr("class", "arc")
                            .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

                            //Draw arc paths
                            arcs.append("path")
                                .attr("fill", (d, i)=> {
                                    return color(i);
                                })
                                .attr("d", arc);

                            //Labels
                            arcs.append("text")
                                .attr("transform", (d)=> {
                                    return "translate(" + arc.centroid(d) + ")";
                                })
                                .attr("text-anchor", "middle")
                                .attr("fill", "white")
                                .text((d)=> {
                                    return d.value;
                                }); 
                    }
                    else if (select4 == 3) {
                        arcs = svg4.selectAll("g.arc")
                            .data(pie(switches))
                            .enter()
                            .append("g")
                            .attr("class", "arc")
                            .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

                            //Draw arc paths
                            arcs.append("path")
                                .attr("fill", (d, i)=> {
                                    return color(i);
                                })
                                .attr("d", arc);

                            //Labels
                            arcs.append("text")
                                .attr("transform", (d)=> {
                                    return "translate(" + arc.centroid(d) + ")";
                                })
                                .attr("text-anchor", "middle")
                                .attr("fill", "white")
                                .text((d)=> {
                                    return d.value;
                                }); 
                        }

                    })


                })		
		</script>
    </script>

</body>

</html>